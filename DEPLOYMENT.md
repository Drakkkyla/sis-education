# Инструкция по развертыванию

> **Развертывание на хостинге Node.js через SFTP?** См. [DEPLOYMENT_HOSTING.md](./DEPLOYMENT_HOSTING.md)  
> **Нужна быстрая шпаргалка?** См. [QUICK_DEPLOY.md](./QUICK_DEPLOY.md)

---

# Инструкция по развертыванию на Windows 11

## Требования

- Windows 11
- Node.js 18+ (скачать с https://nodejs.org/)
- MongoDB (локально или MongoDB Atlas)
- Права администратора для настройки файрвола

## Быстрый старт

### Шаг 1: Установка зависимостей

Запустите `install-server.bat` - это установит все необходимые пакеты.

### Шаг 2: Настройка

Запустите `setup-server.bat` - это создаст конфигурационные файлы.

Вам нужно будет указать:
- IP адрес сервера (узнать можно командой `ipconfig`)
- Вариант MongoDB (локальный или Atlas)

### Шаг 3: Настройка файрвола

Запустите `configure-firewall.bat` **от имени администратора** (правой кнопкой мыши → Запуск от имени администратора).

Это откроет порты:
- 5000 - для бэкенда
- 5173 - для фронтенда

### Шаг 4: Запуск сервера

#### Для продакшена:
Запустите `start-server.bat`

#### Для разработки:
Запустите `start-server-dev.bat`

## Доступ к системе

После запуска сервера:

1. **На сервере**: http://localhost:5173
2. **Из сети**: http://<IP-адрес-сервера>:5173

Например, если IP сервера `192.168.1.100`, то доступ будет: `http://192.168.1.100:5173`

## Узнать IP адрес сервера

Откройте командную строку и выполните:
```cmd
ipconfig
```

Найдите "IPv4-адрес" в разделе вашего сетевого адаптера (обычно это Ethernet или Wi-Fi).

## Настройка MongoDB

### Вариант 1: Локальный MongoDB

1. Скачайте MongoDB Community Server с https://www.mongodb.com/try/download/community
2. Установите MongoDB
3. Запустите MongoDB службу
4. В `setup-server.bat` выберите вариант 1

### Вариант 2: MongoDB Atlas (облачный)

1. Зарегистрируйтесь на https://www.mongodb.com/cloud/atlas
2. Создайте бесплатный кластер
3. Получите connection string
4. В `setup-server.bat` выберите вариант 2 и вставьте connection string

## Первый запуск

После первого запуска создайте администратора:

1. Откройте http://<IP-сервера>:5173
2. Зарегистрируйтесь (это будет первый пользователь)
3. В базе данных измените роль пользователя на `admin`:
   - Откройте MongoDB Compass или используйте команду:
   ```javascript
   db.users.updateOne({username: "ваш_логин"}, {$set: {role: "admin"}})
   ```

Или используйте скрипт seed для создания тестового администратора:
```cmd
cd backend
npm run seed
```

## Автозапуск при загрузке Windows

Чтобы сервер запускался автоматически при включении компьютера:

1. Создайте ярлык для `start-server.bat`
2. Нажмите Win+R, введите `shell:startup`
3. Скопируйте ярлык в открывшуюся папку

## Решение проблем

### Порт уже занят

Если порт 5000 или 5173 занят:
1. Найдите процесс: `netstat -ano | findstr :5000`
2. Завершите процесс или измените порт в `.env` файлах

### Не могу подключиться из сети

1. Проверьте, что файрвол настроен (`configure-firewall.bat`)
2. Убедитесь, что компьютеры в одной сети
3. Проверьте IP адрес сервера (`ipconfig`)
4. Попробуйте отключить файрвол временно для проверки

### MongoDB не подключается

1. Проверьте, что MongoDB запущен (для локального)
2. Проверьте connection string (для Atlas)
3. Проверьте файл `backend/.env`

## Структура файлов

```
Sis/
├── backend/          # Бэкенд сервер
│   ├── .env         # Конфигурация (создается setup-server.bat)
│   └── dist/        # Скомпилированный код
├── frontend/         # Фронтенд
│   ├── .env.production  # Конфигурация (создается setup-server.bat)
│   └── dist/        # Скомпилированный фронтенд
├── install-server.bat      # Установка зависимостей
├── setup-server.bat        # Настройка
├── configure-firewall.bat  # Настройка файрвола
├── start-server.bat        # Запуск (продакшен)
└── start-server-dev.bat    # Запуск (разработка)
```

## Безопасность

⚠️ **Важно для продакшена:**

1. Измените `JWT_SECRET` в `backend/.env` на случайную строку
2. Используйте сильные пароли для администраторов
3. Регулярно обновляйте зависимости
4. Рассмотрите использование HTTPS (требует настройки SSL сертификата)

## Поддержка

При возникновении проблем проверьте логи в окнах консоли, которые открываются при запуске сервера.

